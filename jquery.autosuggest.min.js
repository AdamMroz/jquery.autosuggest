jQuery.fn.highlight=function(t){var s=new RegExp(t,"gi");return this.each(function(){$(this).contents().filter(function(){return 3==this.nodeType&&s.test(this.nodeValue)}).replaceWith(function(){return(this.nodeValue||"").replace(s,function(t){return"<b>"+t+"</b>"})})})},$.fn.autosuggest=function(t){var s=$.extend({server:"asg_server.php",delay:600,start:2},t),e=$(this),a=($(this).attr("id"),$(this).width()),i=s.start-1;e.wrap('<div class="cp-asuggest-wrap"></div>'),e.closest(".cp-asuggest-wrap").append('<div class="cp-asuggest-list-box"></div>'),e.next(".cp-asuggest-list-box").css({"min-width":a}),e.on("keyup",function(){function t(){a=0;var t=e.val().trim();e.val().trim().length>i?(e.next(".cp-asuggest-list-box").empty(),$.ajax({url:s.server,method:"POST",dataType:"json",data:{query:t},success:function(s){$.each(s,function(t,s){e.next(".cp-asuggest-list-box").append('<div data-id="'+s.id+'" class="cp-asuggest-list cp-asg-onlist-'+s.count+'">'+s.name+"</div>")}),c=e.closest(".cp-asuggest-wrap").find(".cp-asuggest-list").length,e.closest(".cp-asuggest-wrap").find(".cp-asuggest-list").highlight(t)}})):e.next(".cp-asuggest-list-box").empty()}e.attr("data-id","0"),$(".cp-asuggest-list-box").empty();var a=0,c=0;e.val().trim().length>=i&&(timer=0,e.off("keyup").on("keyup",function(i){if(e.attr("data-id","0"),38!=i.which&&40!=i.which&&13!=i.which)timer&&clearTimeout(timer),timer=setTimeout(t,s.delay);else{if(40==i.which&&(a==c?a=c:a++,e.closest(".cp-asuggest-wrap").find(".cp-asuggest-list").removeClass("cp-asg-selected"),e.closest(".cp-asuggest-wrap").find(".cp-asg-onlist-"+a).addClass("cp-asg-selected")),38==i.which){a>0&&(1==a?a=1:a--,e.closest(".cp-asuggest-wrap").find(".cp-asuggest-list").removeClass("cp-asg-selected"),e.closest(".cp-asuggest-wrap").find(".cp-asg-onlist-"+a).addClass("cp-asg-selected"));var n=e.val();e.val(""),e.val(n)}if(13==i.which&&a>0){var g=e.closest(".cp-asuggest-wrap").find(".cp-asg-onlist-"+a).text(),l=e.closest(".cp-asuggest-wrap").find(".cp-asg-onlist-"+a).attr("data-id");e.next(".cp-asuggest-list-box").empty(),e.val(g).attr("data-id",l)}}}))}),$(document).off("click",".cp-asuggest-list").on("click",".cp-asuggest-list",function(t){var s=$(this).text(),e=$(this).attr("data-id");return"0"!=e&&($(this).closest(".cp-asuggest-wrap").find("input").val(s).attr("data-id",e),$(this).closest(".cp-asuggest-list-box").empty()),t.preventDefault(),!1}),$(document).on("click","html",function(){$(".cp-asuggest-list-box").empty()})};